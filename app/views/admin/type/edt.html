<!--
 * @Description: In User Settings Edit
 * @Author: your name
 * @Date: 2019-07-25 11:08:34
 * @LastEditTime: 2019-08-20 15:26:54
 * @LastEditors: Please set LastEditors
 -->
<script>
    var error = <%- error %>;
    var aType = <%- JSON.stringify(aType) %>;
    var allType = <%- JSON.stringify(allType) %>;
    console.log("@@@@@@@@@@allType:",allType)
    console.log("@@@@@@@@@@aType:",aType)
</script>
<div class="container-fluid base type-edt">
    <div class="row head">
        <div class="col-xs-12">
            <span>系统管理-栏目管理-编辑栏目</span>
        </div>
    </div>
    <div class="row tips">
        <div class="col-xs-12">
            <p class="ti"><i class="iconfont icon-yiliaohangyedeICON-">&nbsp;</i>操作提示</p>
           <div class="col-xs-12">
                <p class="indent">基本设置由：“安全设置、验证码设置、网站LOGO、地图设置、缓存设置、”组成。</p>     
           </div>
        </div>
    </div>
    
    <div class="row form">
        <form id="type-edt" data-form-async='json' action="/admin/type/save" method="post" >
            <input type="hidden" name='tag' value="edt" />
            <input type="hidden" name='atid' value="{{id}}" />
            <input type="hidden" name='ctag' value="<%- echo(ctag) %>" />
            <input type="hidden" name='cmid' value="{{componentid}}" />
            <table class="table">
                <thead>
                    <tr>
                        <th class="col-xs-2">参数说明</th>
                        <th>参数值</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>栏目名称：</td>
                        <td>
                            <div class="form-group col-xs-4">
                                <input type="text" class="form-control" name="typename" placeholder="栏目名称" value="{{typename}}"/>
                            </div>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;如：</span>
                        </td>              
                    </tr>
                    <tr>
                        <td>所属栏目：</td>
                        <td>
                            <div class="form-group col-xs-4">
                                <div data-freemodal="type" data-name="选择栏目名称" style="height:3em;line-height:3em;border:1px solid #CFDADD;padding-left:1em;">{{- return treeValue(allType, 'id', topid, 'typename'); }}</div>
                                <input type="hidden" name="topid" value="{{topid}}"/>
                            </div>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i></span>
                        </td> 
                    </tr>
                    <tr>
                        <td>隐藏栏目：</td>
                        <td style="padding-left:26px; ">
                            <label class="mui-switch-em"><input class="mui-switch mui-switch-anim is-hidden" type="checkbox" name="ishidden" {{- return ishidden?"checked":""; }} value="1" /><em></em></label>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;设置栏目是否显示在网站栏目列表</span>
                        </td>    
                    </tr>
                    <tr>
                        <td>是否发布：</td>
                        <td style="padding-left:26px; ">
                            <label class="mui-switch-em"><input class="mui-switch mui-switch-anim is-pub" type="checkbox" {{- return issend?"checked":""; }} name="issend" value="1"/><em></em></label>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;如果没有为是，没前栏目有可以网站中访问</span>
                        </td>    
                    </tr>
                    <tr>
                        <td>最大页数：</td>
                        <td>
                            <div class="form-group col-xs-4">
                                <input type="number" class="form-control" placeholder="当前栏目能创建多少页" name="maxpage" value="{{maxpage}}"/>
                            </div>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;设置当前栏目最多能创建多少个页面,-1表示不无限个</span>
                        </td> 
                    </tr>
                    <tr>
                        <td>权重：</td>
                        <td>
                            <div class="form-group col-xs-4">
                                <input type="number" class="form-control" placeholder="用于排序" name="corank" value="{{corank}}"/>
                            </div>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;数字越大越靠前</span>
                        </td> 
                    </tr>
                    <tr>
                        <td>SEO标题：</td>
                        <td>
                            <div class="form-group col-xs-4">
                                <input type="text" class="form-control" placeholder="用于SEO" name="seotitle" value="{{seotitle}}"/>
                            </div>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;SEO标题</span>
                        </td> 
                    </tr>
                    <tr>
                        <td>关键词：</td>
                        <td>
                            <div class="form-group col-xs-4">
                                <input type="text" class="form-control" placeholder="用于SEO" name="keywords" value="{{keywords}}"/>
                            </div>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;优化栏目关键词让搜索引擎更容易找到</span>
                        </td> 
                    </tr>
                    <tr>
                        <td>栏目描述：</td>
                        <td>
                            <div class="form-group col-xs-4">
                                <input type="text" class="form-control" placeholder="描述一下栏目有哪些特点" name="description" value="{{description}}"/>
                            </div>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;描述一下栏目有哪些特点</span>
                        </td> 
                    </tr>
                    <tr>
                        <td>网站路由：</td>
                        <td>
                            <div class="form-group col-xs-4">
                                <input type="text" class="form-control" placeholder="" name="sitepath" value="{{sitepath}}"/>
                            </div>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;</span>
                        </td> 
                    </tr>
                    <tr>
                        <td>网站url：</td>
                        <td>
                            <div class="form-group col-xs-4">
                                <input type="text" class="form-control" placeholder="" name="siteurl" value="{{siteurl}}"/>
                            </div>
                            <span style="line-height: 40px;"><i class="iconfont icon-tishi" style="color: #1C66A7;"></i>&nbsp;</span>
                        </td> 
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td></td>
                        <td>
                            <button type="submit" class="btn">确定</button>
                            <button type="reset" class="btn">重置</button>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </form>
    </div>
</div>
<script src="/bootstrap/js/plugins/nestable/jquery.nestable.js"></script>

<script>
    DL({
        id: "#type-edt ",
        clearCode: 1,
        packet:{
            error: error,
            data: aType[0]
        },
        after: function(){
            effect.setSelect(".auto-type-name");
            app.load(".type-edt");
            effect.switch(".is-hidden", '显示', '隐藏');
            effect.switch(".is-pub", '是', '否');
            app.addonParams = {oid: getItem('OID')};
        }
    });

    /**
     * nestable模态框--(栏目列表和分类列表)
     */
        $("[data-freemodal]").click(function(){
        var me = $(this);
        var title = me.attr('data-name');
        effect.modal({
            title: title,
            confirm: function(item){}
        });
        var types = <%- error ? false : JSON.stringify(allType) %> || [];
        effect.nestable(types, error, '#modal-body');
        $("#normalModal").find(".dd").nestable('collapseAll');
        $("#normalModal").find('[data-action="collapse"]').click();
        $('#modal-body').find('li .dd-edit').hide();
        $('.modal-footer').children('.cancle').hide();
        $('#modal-body').find('li .dd-addon-handel').removeClass('hidden');
        $("#normalModal").find('li .dd-addon-handel').unbind("click").on("click",function(){
            var li = $(this).parent();
            $("#normalModal").find(".dd-handle").removeClass('dd-addon-click');
            $(this).siblings('.dd-handle').addClass("dd-addon-click");
            me.html(li.attr('data-name'));
            me.attr("data-val",li.attr('data-val'));
            me.siblings('input').val(li.attr('data-val'));
            //$("#normalModal").toggle();
        });
    });


    /**
     * 数据保存后状态调用 
     */
    function save(res){
        delete res.uri;
        app.notice(res,function(){
            if(!res.error) go('/admin/type/index' + res.ctag);
        });
    }
    
</script>